webpackJsonp([2],{"9/SN":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r("bvGF"),l={mounted:function(){this.map=new AMap.Map("taskPlanGDMap",{resizeEnable:!0}),this.map.setZoom(2),this.map.setCenter([116.39,39.9]);var e=new AMap.ToolBar;this.map.addControl(e),this.mouseTool=new AMap.MouseTool(this.map)},data:function(){var e=this;return{map:"",mouseTool:"",tableNameList:[],dataSourceName:"",form:{name:"",layerMin:"",layerMax:"",sourceType:"1",sourceAddress:"",preCode:"",epsg:"4326",rowkeyType:"1",sourceTablename:"",outputPath:"",comments:"",lonBegin:"",latBegin:"",lonEnd:"",latEnd:""},rules:{name:[{required:!0,message:"请输入任务名称",trigger:"blur"},{validator:function(e,t,r){/[`~!@#$%^&*()+= <>?:"{},.\\/;'[\]]/im.test(t)||/[·！#￥（——）：；“”‘、，…… |《。》？、【】[\]]/im.test(t)?r(new Error("任务名只能包含数字、中文、字母、下划线、短横线！")):/^[a-zA-Z\u4e00-\u9fa5]{1}/.test(t)?t.length>100?r(new Error("任务名长度范围0-100")):r():r(new Error("任务名必须以汉字或字母开头"))},trigger:"blur"}],layerMin:[{required:!0,message:"请输入最小层级",trigger:"blur"},{type:"number",message:"必须为数字值",trigger:"blur"},{validator:function(t,r,a){r>e.form.layerMax?a(new Error("最小层级不能大于最大层级")):r<0||r>23?a(new Error("层级范围在0~23之间")):a()},trigger:"blur"}],layerMax:[{required:!0,message:"请输入最大层级",trigger:"blur"},{type:"number",message:"必须为数字值",trigger:"blur"},{validator:function(t,r,a){r<e.form.layerMin?a(new Error("最大层级不能小于最小层级")):r<0||r>23?a(new Error("层级范围在0~23之间")):a()},trigger:"blur"}],sourceAddress:[{required:!0,message:"请选择数据源",trigger:"blur"}],sourceTablename:[{required:!0,message:"请选择表名称",trigger:"blur"}],preCode:[{required:!0,message:"请输入layerId",trigger:"blur"},{type:"number",message:"必须为数字值",trigger:"blur"}],epsg:[{required:!0,message:"请选择epsg",trigger:"blur"}],rowkeyType:[{required:!0,message:"请选择rowkeyType",trigger:"blur"}],outputPath:[{required:!0,message:"请输入数据输出目录地址",trigger:"blur"}],lonBegin:[{required:!0,message:"请输入左上角经度",trigger:"blur"},{type:"number",message:"必须为数字值",trigger:"blur"},{validator:function(t,r,a){r>e.form.lonEnd?a(new Error("左上角经度应小于右下角经度")):r<-180||r>180?a(new Error("经度范围在-180~180之间")):a()},trigger:"blur"}],lonEnd:[{required:!0,message:"请输入右下角经度",trigger:"blur"},{type:"number",message:"必须为数字值",trigger:"blur"},{validator:function(t,r,a){r<e.form.lonBegin?a(new Error("右下角经度应大于左上角经度")):r<-180||r>180?a(new Error("经度范围在-180~180之间")):a()},trigger:"blur"}],latBegin:[{required:!0,message:"请输入左上角纬度",trigger:"blur"},{type:"number",message:"必须为数字值",trigger:"blur"},{validator:function(t,r,a){r>e.form.latEnd?a(new Error("左上角纬度应小于右下角纬度")):r<-180||r>180?a(new Error("纬度范围在-90~90之间")):a()},trigger:"blur"}],latEnd:[{required:!0,message:"请输入左上角纬度",trigger:"blur"},{type:"number",message:"必须为数字值",trigger:"blur"},{validator:function(t,r,a){r<e.form.latBegin?a(new Error("右下角纬度应大于左上角纬度")):r<-180||r>180?a(new Error("纬度范围在-90~90之间")):a()},trigger:"blur"}]},dialogTableVisible:!1,tableData:[{name:"dass",address:"dddfsd"}],allPage:1,currentPage:1,pageSize:10}},methods:{drawRectangle:function(){var e=this;e.mouseTool.close(!0),e.mouseTool.rectangle(),AMap.event.addListener(e.mouseTool,"draw",function(t){e.getFourPositon(t.obj.getPath()[1].lng,t.obj.getPath()[1].lat,t.obj.getPath()[3].lng,t.obj.getPath()[3].lat),e.mouseTool.close(!1)})},closeRectangle:function(){this.mouseTool.close(!0),this.getFourPositon("","","","")},getFourPositon:function(e,t,r,a){this.form.lonBegin=r,this.form.latBegin=a,this.form.lonEnd=e,this.form.latEnd=t},submitTask:function(){var e=this;this.$refs.form.validate(function(t){if(t&&1==e.form.sourceType)Object(a.c)(e.form).then(function(){e.$message({message:"创建任务成功",type:"success"})});else{if(!t||2!=e.form.sourceType)return!1;delete e.form.preCode,delete e.form.rowkeyType,Object(a.c)(e.form).then(function(){e.$message({message:"创建任务成功",type:"success"})})}})},refreshDataSource:function(){var e=this;Object(a.f)(this.currentPage,this.pageSize,this.form.sourceType).then(function(t){e.tableData=t.data.list,e.allPage=t.data.total})},tabPage:function(e){this.currentPage=e,this.refreshDataSource()},selectDataSource:function(){this.currentPage=1,this.form.sourceTablename="",this.dialogTableVisible=!0,this.refreshDataSource()},checkedDataSource:function(){this.form.sourceAddress?this.dialogTableVisible=!1:this.$message({message:"请至少选择一条合法数据",type:"warning"})},changeFun:function(e,t){this.$refs.multipleTable.clearSelection(),this.$refs.multipleTable.toggleRowSelection(t),this.form.sourceAddress=e[e.length-1].address,this.dataSourceName=e[e.length-1].name,this.tableNameList=e[e.length-1].items},selectAll:function(){this.$refs.multipleTable.clearSelection()},tabSourceType:function(){this.dataSourceName=""}}},o={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"task-enter-wrap"},[r("div",{attrs:{id:"taskPlanGDMap"}}),e._v(" "),r("div",{staticClass:"task-enter-main"},[r("el-form",{ref:"form",staticStyle:{padding:"0px 15px"},attrs:{model:e.form,rules:e.rules,size:"small","label-width":"110px"}},[r("el-form-item",{attrs:{label:"任务名称",prop:"name"}},[r("el-input",{staticStyle:{width:"290px"},attrs:{placeholder:""},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"最小层级",prop:"layerMin"}},[r("el-input",{staticStyle:{width:"290px"},attrs:{placeholder:""},model:{value:e.form.layerMin,callback:function(t){e.$set(e.form,"layerMin",e._n(t))},expression:"form.layerMin"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"最大层级",prop:"layerMax"}},[r("el-input",{staticStyle:{width:"290px"},attrs:{placeholder:""},model:{value:e.form.layerMax,callback:function(t){e.$set(e.form,"layerMax",e._n(t))},expression:"form.layerMax"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"数据源类型",prop:"sourceType"}},[r("el-select",{on:{change:e.tabSourceType},model:{value:e.form.sourceType,callback:function(t){e.$set(e.form,"sourceType",t)},expression:"form.sourceType"}},[r("el-option",{attrs:{label:"HBase",value:"1"}}),e._v(" "),r("el-option",{attrs:{label:"MBTiles",value:"2"}})],1)],1),e._v(" "),r("el-form-item",{attrs:{label:"数据源路径",prop:"sourceAddress"}},[r("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.selectDataSource}},[e._v("选择数据源")]),e._v("\n\t\t\t\t\t"+e._s(e.dataSourceName)+"\n\t\t\t\t")],1),e._v(" "),1==e.form.sourceType?r("el-form-item",{attrs:{label:"layerId",prop:"preCode"}},[r("el-input",{staticStyle:{width:"290px"},attrs:{placeholder:""},model:{value:e.form.preCode,callback:function(t){e.$set(e.form,"preCode",e._n(t))},expression:"form.preCode"}})],1):e._e(),e._v(" "),r("el-form-item",{attrs:{label:"epsg",prop:"epsg"}},[r("el-select",{model:{value:e.form.epsg,callback:function(t){e.$set(e.form,"epsg",t)},expression:"form.epsg"}},[r("el-option",{attrs:{label:"4326",value:"4326"}}),e._v(" "),r("el-option",{attrs:{label:" 3857",value:"3857"}})],1)],1),e._v(" "),1==e.form.sourceType?r("el-form-item",{attrs:{label:"rowkeyType",prop:"rowkeyType"}},[r("el-select",{model:{value:e.form.rowkeyType,callback:function(t){e.$set(e.form,"rowkeyType",t)},expression:"form.rowkeyType"}},[r("el-option",{attrs:{label:"单表rowkey解析（v1）",value:"1"}}),e._v(" "),r("el-option",{attrs:{label:" 多表合一rowkey解析（v2）",value:"2"}})],1)],1):e._e(),e._v(" "),r("el-form-item",{attrs:{label:"数据源表名称",prop:"sourceTablename"}},[r("el-select",{model:{value:e.form.sourceTablename,callback:function(t){e.$set(e.form,"sourceTablename",t)},expression:"form.sourceTablename"}},e._l(e.tableNameList,function(e){return r("el-option",{key:e.id,attrs:{label:e.name,value:e.name}})}),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"数据输出路径",prop:"outputPath"}},[r("el-input",{staticStyle:{width:"290px"},attrs:{placeholder:""},model:{value:e.form.outputPath,callback:function(t){e.$set(e.form,"outputPath",t)},expression:"form.outputPath"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"备注信息",prop:"comments"}},[r("el-input",{staticStyle:{width:"290px"},attrs:{type:"textarea"},model:{value:e.form.comments,callback:function(t){e.$set(e.form,"comments",t)},expression:"form.comments"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"左下角经度",prop:"lonBegin"}},[r("el-input",{staticStyle:{width:"290px"},attrs:{placeholder:""},model:{value:e.form.lonBegin,callback:function(t){e.$set(e.form,"lonBegin",e._n(t))},expression:"form.lonBegin"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"左下角纬度",prop:"latBegin"}},[r("el-input",{staticStyle:{width:"290px"},attrs:{placeholder:""},model:{value:e.form.latBegin,callback:function(t){e.$set(e.form,"latBegin",e._n(t))},expression:"form.latBegin"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"右上角经度",prop:"lonEnd"}},[r("el-input",{staticStyle:{width:"290px"},attrs:{placeholder:""},model:{value:e.form.lonEnd,callback:function(t){e.$set(e.form,"lonEnd",e._n(t))},expression:"form.lonEnd"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"右上角纬度",prop:"latEnd"}},[r("el-input",{staticStyle:{width:"290px"},attrs:{placeholder:""},model:{value:e.form.latEnd,callback:function(t){e.$set(e.form,"latEnd",e._n(t))},expression:"form.latEnd"}})],1)],1),e._v(" "),r("div",{staticClass:"task-enter-btn"},[r("el-button",{attrs:{type:"primary"},on:{click:e.drawRectangle}},[e._v("绘 制")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:e.closeRectangle}},[e._v("清 除")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:e.submitTask}},[e._v("提交任务")])],1),e._v(" "),r("el-dialog",{attrs:{title:"选择数据源",visible:e.dialogTableVisible},on:{"update:visible":function(t){e.dialogTableVisible=t}}},[r("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.tableData},on:{select:e.changeFun,"select-all":e.selectAll}},[r("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),r("el-table-column",{attrs:{prop:"name",label:"名称",width:"300"}}),e._v(" "),r("el-table-column",{attrs:{prop:"address",label:"地址"}})],1),e._v(" "),r("el-pagination",{staticStyle:{"text-align":"center",padding:"25px 0px"},attrs:{background:"",layout:"total, prev, pager, next","current-page":e.currentPage,"page-size":e.pageSize,total:e.allPage},on:{"current-change":e.tabPage}}),e._v(" "),r("div",[r("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.checkedDataSource}},[e._v("确定")]),e._v(" "),r("el-button",{attrs:{size:"small"},on:{click:function(t){e.dialogTableVisible=!1}}},[e._v("取消")])],1)],1)],1)])},staticRenderFns:[]};var s=r("C7Lr")(l,o,!1,function(e){r("T4tJ")},"data-v-b4f292da",null);t.default=s.exports},T4tJ:function(e,t){}});